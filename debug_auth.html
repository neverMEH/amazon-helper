<\!DOCTYPE html>
<html>
<head>
    <title>Debug Auth</title>
</head>
<body>
    <h1>Debug Authentication</h1>
    <button onclick="checkAuth()">Check Auth Status</button>
    <button onclick="doLogin()">Login</button>
    <button onclick="clearAuth()">Clear Auth</button>
    <pre id="output"></pre>

    <script>
        function log(msg) {
            document.getElementById('output').textContent += msg + '\n';
        }

        function checkAuth() {
            log('\n=== Checking Auth Status ===');
            const token = localStorage.getItem('access_token');
            const user = localStorage.getItem('user');
            
            log('Token: ' + (token ? token.substring(0, 50) + '...' : 'NOT FOUND'));
            log('User: ' + (user ? user : 'NOT FOUND'));
            
            // Try to decode JWT payload
            if (token) {
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    log('Token expires: ' + new Date(payload.exp * 1000).toLocaleString());
                    log('Token issued: ' + new Date(payload.iat * 1000).toLocaleString());
                } catch (e) {
                    log('Error decoding token: ' + e.message);
                }
            }
        }

        async function doLogin() {
            log('\n=== Performing Login ===');
            try {
                const response = await fetch('http://localhost:8001/api/auth/login?email=nick@nevermeh.com&password=', {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.access_token) {
                    localStorage.setItem('access_token', data.access_token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    log('Login successful\!');
                    log('Token stored: ' + data.access_token.substring(0, 50) + '...');
                } else {
                    log('Login failed: ' + JSON.stringify(data));
                }
            } catch (e) {
                log('Login error: ' + e.message);
            }
        }

        function clearAuth() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('user');
            log('\n=== Auth Cleared ===');
        }

        // Check on load
        window.onload = () => checkAuth();
    </script>
</body>
</html>
